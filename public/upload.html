<!DOCTYPE html>
<html lang="en">
		<head>
				<meta charset="UTF-8">
				<meta name="viewport" content="width=device-width, initial-scale=1.0">
				<title>Upload</title>
				<link rel="stylesheet" href="style.css">
				<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
		</head>
		<body>
				<!-- ERROR -->
				<div class="center">
						<p>Click on the map to select a coordinate</p>
						<div id="mapEmbed">
								<div id="map"></div>
						</div>
						<form action="upload" method="POST" enctype="multipart/form-data">
								<label>Latitude:</label>
								<input type="text" name="lat" placeholder="Latitude" id="lat"><br>
								<label>Longitude:</label>
								<input type="text" name="long" placeholder="Longitude" id="long"><br>

								<label class="btn">
										ðŸ“· Take or Upload Image
										<input name="image" type="file" accept="image/*" capture="environment" required hidden>
								</label><br>
								<input type="submit" value="Upload Image" disabled/>
						</form>
				</div>
				<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
				<script>
				 const map = L.map('map').setView([48.2621, 11.6676], 16);
				 L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
						 attribution: 'Â© OpenStreetMap contributors'
				 }).addTo(map);
				 
				 let marker = null;

				 map.on('click', function(e) {
						 const lat = e.latlng.lat.toFixed(6);
						 const lng = e.latlng.lng.toFixed(6);

						 updateMarker(lat, lng);
						 
						 document.getElementById('lat').value = lat;
						 document.getElementById('long').value = lng;

						 const form = document.querySelector('form');
						 form.querySelector('input[type="submit"]').disabled = false;
				 });

				 function updateMarker(lat, lng) {
						 const latlng = L.latLng(lat, lng);
						 if (marker) {
								 marker.setLatLng(latlng);
						 } else {
								 marker = L.marker(latlng).addTo(map);
						 }
						 map.panTo(latlng);
				 }
				 
				 ['lat', 'long'].forEach(id => {
						 const input = document.getElementById(id);
						 document.getElementById(id).addEventListener('input', () => {
								 const lat = parseFloat(document.getElementById('lat').value);
								 const lng = parseFloat(document.getElementById('long').value);
								 if (!isNaN(lat) && !isNaN(lng)) {
										 updateMarker(lat, lng);
										 form.querySelector('input[type="submit"]').disabled = false;
								 } else {
										 form.querySelector('input[type="submit"]').disabled = true;
								 }
						 });
						 input.addEventListener('keydown', (e) => {
								 if (e.key === 'Enter') {
										 e.preventDefault();
								 }
						 });
				 });
				</script>
		</body>
</html>
